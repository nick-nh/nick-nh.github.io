---
layout: post
title: "Renko bars"
author: "nnh"
tags: [Квик,квик,индикатор,lua,ренко,renko,qlua]
---

В терминале Квик нет возможности выводить свой временной ряд. При создании индикатора мы может только вывести линии в неком открытом графике. Поэтому, чтобы вывести бары Ренко мы можем использовать линии.
Визуально это будет похоже на индикатор "ценовой канал".

Теперь про сам индикатор. [Его можно взять здесь](https://github.com/nick-nh/qlua/blob/master/RenkoATR.lua).

Методика построения баров Ренко заключается в том, что новый "кирпичик" рисуется только тогда, когда цена пройдет определенное расстояние. Каждый новый кирпичик всегда отображается правее предыдущего и располагается выше или ниже него.
Если цена превышает верхний уровень предыдущего кирпичика на величину порога или более, рисуют соответствующее число кирпичик выше — чтобы нижняя граница нового кирпичика соответствовала верхней границе предыдущего. Если цена падает ниже дна предыдущего кирпичика на размер порога или более, рисуют соответствующее кирпичик, чтобы верхняя граница нового кирпичика соответствовала нижней границе предыдущего.
Т.о. происходит компрессия временного ряда, т.к. если цена меняется в диапазоне одного бара, то новые бары Ренко не добавляются. Число баров будет меньше чем в исходном временном ряде.

Исходя из методики построения можно отметить два важных фактора:
- Важно определить размер "кирпичика", т.к. от его размера зависит все построение
- Итоговая картина чувствительна от начальной точки построения.
<br><br>

## Размер "кирпичика"
<br>

Основной вариант построения - это просто задание фиксированного размера. Т.е. просто определяем размер шага в каких-то величинах (пункты, валюта цены и т.д.) и когда цена превышает этот порог происходит построение.
Второй вариант - так называемый адаптивный. Это когда размер кирпичика определяется по какому-то алгоритму. наиболее частый вариант - это ATR. Он заключается в том, что перед построением происходит расчет значения ATR
на момент построения (текущий момент) и уже полученное значение выбирается как размер кирпичика. Можно использовать и другие методики расчета размера.

У второго варианта есть недостаток: мы определяем размер кирпичика в текущий момент времени, но при этом "строим график" в прошлом. А т.к. построение зависит от точки отсчета и размера кирпичика, то при других начальных условия график будет выглядеть совсем иначе.

Можно попробовать использовать вариант, когда расчет размера кирпичика будет происходить по мере движения цены. Т.е. он будет не фиксированным на всем участке графика, а будет меняться в зависимости от характера графика.
<br><br>

## Настройки индикатора
<br>

Индикатор добавляется стандартным образом: необходимо разместить файл индикатора в папке Luaindicators терминала (если ее нет, то создать). Также необходимо там же разместить [библиотеку maLib](https://github.com/nick-nh/qlua/blob/master/maLib.lua).

В результате индикатор можно будет добавить на график.
<br>
![](/assets/images/renko/renko_0.PNG)
<br>

Настройки:
- brickType           -- Тип расчета Renko; ATR; Std - стандартное отклонение; Fix - фиксированный размер, заданный в br_size
    - Для установки значения, необходимо поставить * перед выбранным вариантом.
- br_size             -- Фиксированный размер шага. Если задан, то строится по указанному размеру (в пунктах)
- recalc_brick        -- Пересчитывать размер блока каждый период-бар
- shift_limit         -- Сдвигать границу по пересчитанному размеру блока
- min_recalc_brick    -- Минимизировать размер блока при пересчете
- data_type           -- Данные для расчета 0 - Close; 1 - High|Low
- k                   -- Размер скользящего фильтра, используемый при вычислении размера блока от величины ATR как k*ATR
- period              -- Период расчета ATR
- showRenko           -- Показывать линии Renko; 0 - не показывать; 1 - показывать; 2 - показывать одной линией
- std_ma_method       -- Метод расчета среднего значения при расчете Std.

### Тип расчета
Варианты:
- ATR
- Std - стандартное отклонение
- Fix - фиксированный размер, заданный в br_size

Чтобы задать значение необходимо добавить символ * перед вариантом в строке значения.
<br>

### Фиксированный размер шага
Если задать значение и установлена настройка brickType Fix, то график будет строится с постоянным размером кирпичика.
<br>

### Пересчитывать размер блока
Если задать значение 1, то активируется вариант постоянного пересчета размера кирпичика. Данный режим используется для значений brickType ATR или Std. В этом режиме сначала происходит расчет размера кирпичика по выбранной методике, а далее, по мере поступления новых баров происходит пересчет размера. Т.о. чтобы сформировался новый кирпичик цене необходимо пройти разное расстояние на разных участках графика. При этом размер определяется не в текущий момент времени, а именно в момент построения очередного бара.
<br>

### Сдвигать границу по пересчитанному размеру блока
Если выбран режим пересчета размера, то можно сдвигать границу кирпичика, если его размер изменился. Действительно, если при формировании нового кирпичика его размер был один, то после пересчета он мог уменьшиться. Если сдвинуть пороговую границу (противоположную от направления), то формирование нового кирпичика смены тренда может наступить в другое время. Это хорошо проявляется в периоды "флета". Если в начале движения волатильность была высокой и размер нового кирпичика был большой, то далее он уменьшается. Сдвинув границу кирпичика (для падающего - верхнюю, для растущего - нижнюю) разворот тренда наступит раньше. Тем самым повышается чувствительность к текущей волатильности.
<br>

![](/assets/images/renko/renko_1.PNG)
<br>

На выделенных участках видно как происходит отрисовка изменения размера кирпичика.
<br>

### Минимизировать размер блока при пересчете
Данная настройка позволяет выбрать вариант пересчета нового размера текущего кирпичика не больше предыдущего размера. Т.е. размер текущего кирпичика всегда будет уменьшаться.
<br>

### Данные для расчета
Данная настройка определяет какие данные будет использоваться для расчета.

Возможны варианты:
- 0 - Close - по закрытиям баров
- 1 - High|Low - по максимуму или минимуму баров
<br>

### Размер скользящего фильтра
Обычно, чтобы сформировать новый кирпичик, цене необходимо пройти его размер для построения в том же направлении, и два размера в противоположном. Данный параметр (коэффициент) позволяет управлять итоговым размером кирпичика.
Допустим используется методика ATR, есть величина текущего ATR как размер кирпичка. Задав, допустим, коэффициент 2, итоговый размер кирпичика будет 2*ATR. Или 2 стандартных отклонения для методики Std.
<br>

### Показывать линии Renko
Настройка, определяющая как выводить линии индикатора

- 0 - не показывать (при этом символы смены тренда будут выводиться)
- 1 - показывать
- 2 - показывать одной линией. В этом варианте рисуется только одна линия по направлению. Для падающих - нижняя, для растущих - верхняя.
<br>

### Метод расчета среднего значения при расчете Std
Обычно, для расчета стандартного отклонения, используется расчет среднего по методу SMA (простоя скользящая средняя). В данной настройке можно задать другие варианты, допустим EMA.
<br>

## Использование баров для расчета

Т.к. бары Ренко - это тот же временной ряд, как результат преобразования исходного, то можно его использовать в других алгоритмах, допустим EMA, MACD.

Для примера были написаны индикаторы

[EMA RENKO](https://github.com/nick-nh/qlua/blob/master/emaRenkoATR.lua)
<br>

![](/assets/images/renko/renko_2.PNG)

[MACD RENKO](https://github.com/nick-nh/qlua/blob/master/macdRenkoATR.lua)
<br>

![](/assets/images/renko/renko_3.PNG)


Т.к. данные баров Ренко в другом временном ряде, то вид индикаторов ступенчатый. Но для расчета EMA бары Ренко - это те же данные, что и привычные бары.